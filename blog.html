<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stories & News - Solera Cask</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Blog-specific styles matching Solera's aesthetic */
        .blog-hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--text-white);
            padding: 160px 0 80px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .blog-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><defs><pattern id="grain" width="100" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1.5" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="20" fill="url(%23grain)"/></svg>') repeat,
                url('/images/heritage/solera-spring-mill-distillery.jpg');
            background-size: auto, cover;
            background-position: center, center;
            opacity: 0.5;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .hero-content h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(36px, 6vw, 64px);
            font-weight: 300;
            margin-bottom: 24px;
            line-height: 1.1;
            color: #fff;
        }

        .hero-content p {
            font-size: 18px;
            opacity: 0.9;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .blog-section {
            padding: 120px 0;
            background: var(--warm-white);
        }

        .blog-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 80px;
        }

        .blog-sidebar {
            position: sticky;
            top: 120px;
            height: fit-content;
        }

        .search-container {
            display: flex;
            margin-bottom: 40px;
            border: 1px solid var(--border);
            background: var(--warm-white);
        }

        .search-input {
            flex: 1;
            padding: 16px 20px;
            border: none;
            background: transparent;
            font-size: 15px;
            color: var(--text-primary);
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-light);
        }

        .search-btn {
            background: var(--primary);
            color: var(--text-white);
            border: none;
            padding: 16px 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: var(--primary-dark);
        }

        .filter-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 400;
        }

        .filter-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 40px;
        }

        .filter-btn {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            padding: 12px 20px;
            font-size: 14px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary);
            color: var(--text-white);
            border-color: var(--primary);
        }

        .recent-posts h3 {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 400;
        }

        .recent-post-item {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recent-post-item:hover {
            color: var(--primary);
        }

        .recent-post-item h4 {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .post-date {
            font-size: 12px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .blog-main {
            min-height: 600px;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 60px;
        }

        .post-card {
            background: var(--warm-white);
            border: 1px solid var(--border-light);
            transition: all 0.4s ease;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
            min-height: 275px; /* Add this - adjust the value as needed */
            padding: 0;
        }

        .post-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-strong);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 0 24px; /* Match the padding */
            margin-bottom: 20px;
        }

        .post-type {
            background: var(--primary);
            color: var(--text-white);
            padding: 4px 12px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        .post-date {
            font-size: 12px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .post-content {
            padding: 0 24px 24px 24px; /* Match the header padding */
            flex-grow: 1;
            flex-direction: column;
            display: flex;
        }

        .post-content h3 {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 400;
            color: var(--text-primary);
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .post-content p {
            font-size: 15px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 0px;
            flex-grow: 1;
        }

        .post-link {
            display: inline-block;
            color: var(--primary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
            border-bottom: 1px solid transparent;
        }

        .post-link:hover {
            border-bottom-color: var(--primary);
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: auto;
            padding-top: 20px;
            margin-left: 24px;  /* Add left margin to match content */
            margin-right: 24px; /* Add right margin to match content */
            margin-bottom: 24px; /* Add bottom margin for spacing */
        }

        .post-tag {
            background: var(--light-beige);
            color: var(--text-secondary);
            padding: 4px 8px;
            font-size: 11px;
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .post-tag:hover {
            background: var(--primary);
            color: var(--text-white);
            border-color: var(--primary);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            margin-top: 60px;
        }

        .pagination button {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            padding: 12px 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .pagination button:hover:not(:disabled),
        .pagination button.active {
            background: var(--primary);
            color: var(--text-white);
            border-color: var(--primary);
        }

        .pagination button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .search-results-info {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-style: italic;
            font-size: 15px;
        }

        .no-posts {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-secondary);
        }

        .no-posts h3 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .blog-container {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .blog-sidebar {
                position: static;
                order: 1;
            }

            .filter-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }

            .posts-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 30px;
            }
        }

        @media (max-width: 768px) {
            .blog-hero {
                padding: 120px 0 60px;
            }

            .blog-section {
                padding: 80px 0;
            }

            .blog-container {
                padding: 0 20px;
            }

            .posts-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .post-content h3 {
                font-size: 20px;
            }

            .hero-content {
                padding: 0 20px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav class="container">
            <a href="/" class="logo">
                <img src="images/logos/Solera-Cask-Logo.png" alt="Solera Cask" class="logo-image logo-large">
                <img src="images/logos/SC-Logo.png" alt="Solera Cask" class="logo-image logo-small">
            </a>
            
            <!-- Desktop Menu -->
            <ul class="nav-menu">
                <li><a href="index.html#heritage">Heritage</a></li>
                <li><a href="#products">Products</a></li>
                <li><a href="index.html#types">Sherry Types</a></li>
                <li><a href="index.html#story">Stories</a></li>
                <li><a href="index.html#contact" class="nav-cta">Get Quote</a></li>
            </ul>
    
            <!-- Mobile Hamburger Menu -->
            <div class="mobile-menu-toggle" id="mobileMenuToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    
        <!-- Mobile Menu Overlay -->
        <div class="mobile-menu-overlay" id="mobileMenuOverlay">
            <div class="mobile-menu-content">
                <a href="index.html#heritage" class="mobile-menu-item">Heritage</a>
                <a href="#products" class="mobile-menu-item">Products</a>
                <a href="index.html#types" class="mobile-menu-item">Sherry Types</a>
                <a href="index.html#story" class="mobile-menu-item">Stories</a>
                <a href="index.html#contact" class="mobile-menu-item mobile-cta">Get Quote</a>
            </div>
        </div>
    </header>

    <section class="blog-hero">
        <div class="hero-content">
            <h1>Stories & News</h1>
            <p>Discover the heritage, craftsmanship, and innovations behind our premium sherry barrels from Jerez de la Frontera</p>
        </div>
    </section>

    <section class="blog-section">
        <div class="blog-container">
            <div class="blog-sidebar">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search stories..." class="search-input">
                    <button class="search-btn" onclick="searchPosts()">🔍</button>
                </div>
                
                <div class="filter-section">
                    <h3>Categories</h3>
                    <div class="filter-buttons" id="filterButtons">
                        <button class="filter-btn active" onclick="filterPosts('all'); setActiveFilter(this)">All Stories</button>
                        <button class="filter-btn" onclick="filterPosts('news'); setActiveFilter(this)">News & Updates</button>
                        <button class="filter-btn" onclick="filterPosts('education'); setActiveFilter(this)">Education</button>
                        <button class="filter-btn" onclick="filterPosts('tasting-notes'); setActiveFilter(this)">Tasting Notes</button>
                        <button class="filter-btn" onclick="filterPosts('stories'); setActiveFilter(this)">Heritage</button>
                        <button class="filter-btn" onclick="filterPosts('partnership'); setActiveFilter(this)">Partnerships</button>
                    </div>
                </div>

                <div class="recent-posts">
                    <h3>Recent Stories</h3>
                    <div id="recentPostsList">
                        <!-- Recent posts will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="blog-main">
                <div class="posts-grid" id="postsGrid">
                    <!-- Posts will be dynamically loaded here -->
                </div>
                
                <div class="pagination" id="pagination">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <!-- Brand Section - Far Left -->
                <div class="footer-section footer-brand">
                    <h3>Solera Cask</h3>
                    <p class="brand-motto">Jerez de la Frontera, Spain</p>
                    <div class="social-links">
                        <a href="https://instagram.com/soleracask" target="_blank" rel="noopener noreferrer" class="social-link">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                    </div>
                </div>
    
                <div class="footer-section">
                    <h3>Casks</h3>
                    <ul>
                        <li><a href="/whisky-sherry-barrels.html">Sherry Barrels for Whisky</a></li>
                        <li><a href="/rum-sherry-barrels.html">Sherry Barrels for Rum</a></li>
                        <li><a href="/tequila-sherry-barrels.html">Sherry Barrels for Tequila</a></li>
                        <li><a href="/vodka-sherry-barrels.html">Sherry Barrels for Vodka</a></li>
                        <li><a href="/beer-sherry-barrels.html">Sherry Barrels for Beer</a></li>
                        <li><a href="/sherry-barrels.html">Jerez Sherry Barrels</a></li>
                    </ul>
                </div>
    
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="/#heritage">About Solera Cask</a></li>
                        <li><a href="/blog.html">Stories</a></li>
                        <li><a href="/sherry-barrels-faq.html">FAQ</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
    
                <!-- Contact Section - Far Right -->
                <div class="footer-section footer-contact">
                    <h3>Contact Us</h3>
                    <ul>
                        <li>
                            <a href="mailto:info@soleracask.com" class="contact-link-with-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="contact-icon">
                                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                </svg>
                                info@soleracask.com
                            </a>
                        </li>
                        <li>
                            <a href="https://www.soleracask.com" target="_blank" rel="noopener noreferrer" class="contact-link-with-icon">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="contact-icon">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                                </svg>
                                www.soleracask.com
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Solera Cask. Premium Sherry Barrels from Jerez de la Frontera, Spain. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script src="js/script.js"></script>
    <script>
        
      // Updated Solera Cask Blog JavaScript - Database Connected
// Replace the existing blog JavaScript with this version

document.addEventListener('DOMContentLoaded', function() {
    // Blog API for Solera Cask - Database Connected
    const API_BASE = '/.netlify/functions';
    
    const SoleraBlogAPI = {
        // Get all published posts from database
        getAllPosts: async function() {
            try {
                const response = await fetch(`${API_BASE}/posts-public`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching posts:', error);
                // Fallback to localStorage if server is unavailable
                return this.getLocalPosts();
            }
        },

        // Get single post by ID from database
        getPost: async function(id) {
            try {
                const response = await fetch(`${API_BASE}/posts-public?id=${id}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching post:', error);
                return null;
            }
        },

        // Get single post by slug from database
        getPostBySlug: async function(slug) {
            try {
                const response = await fetch(`${API_BASE}/posts-public?slug=${slug}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching post by slug:', error);
                return null;
            }
        },

        // Create post slug
        createPostSlug: function(post) {
            return post.title
                .toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim('-');
        },

        // Fallback to localStorage (for development/offline)
        getLocalPosts: function() {
            const posts = localStorage.getItem('solera-cask-posts');
            if (posts) {
                return JSON.parse(posts).filter(post => post.status === 'published');
            }
            return this.getDefaultPosts();
        },

        // Default posts for fallback
        getDefaultPosts: function() {
            return [
                {
                    id: "welcome-to-solera-cask-stories",
                    type: "News",
                    date: new Date().toISOString().split('T')[0],
                    title: "Welcome to Solera Cask Stories",
                    excerpt: "Discover the heritage, craftsmanship, and stories behind our premium sherry barrels from Jerez de la Frontera.",
                    content: "Welcome to Solera Cask Stories, where we share the rich heritage and exceptional craftsmanship behind our premium sherry barrels. From our historic solera systems in Jerez de la Frontera to the modern craft distilleries and breweries worldwide, each barrel tells a story of tradition, quality, and transformation. Here you'll find updates on our latest partnerships, educational content about sherry barrel aging, tasting notes from exceptional spirits and beers, and stories from the passionate makers who trust Solera Cask for their most important expressions.",
                    link: "",
                    tags: ["welcome", "heritage", "craftsmanship", "solera", "jerez"],
                    status: "published"
                },
                {
                    id: "understanding-sherry-types-for-aging",
                    type: "Education",
                    date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                    title: "Understanding Sherry Types for Aging",
                    excerpt: "A comprehensive guide to the six sherry types and how each imparts unique characteristics to spirits and beer.",
                    content: "Understanding the different sherry types is crucial for selecting the right barrel for your aging program. Each of the six main sherry types - Fino, Manzanilla, Amontillado, Palo Cortado, Oloroso, and Pedro Ximénez - brings distinct flavor profiles and characteristics to spirits and beer. Fino and Manzanilla, aged under flor, contribute bright, mineral, and saline notes perfect for lighter spirits. Amontillado offers balanced complexity with nutty and oxidative characteristics. Oloroso provides rich, robust flavors ideal for whisky and dark beer styles. Palo Cortado, the rarest type, combines elegance with depth. Pedro Ximénez delivers intense sweetness and rich fruit character for dessert-style expressions.",
                    link: "",
                    tags: ["education", "sherry-types", "aging", "flavor-profiles", "spirits", "beer"],
                    status: "published"
                }
            ];
        }
    };

    // Blog page initialization
    if (window.location.pathname.includes('/blog') || window.location.pathname === '/blog.html') {
        initializeBlogPage();
    }

    // Post page initialization  
    if (window.location.pathname.includes('/post') || window.location.pathname === '/post.html') {
        initializePostPage();
    }

    // Initialize blog page
    async function initializeBlogPage() {
        try {
            const allPosts = await SoleraBlogAPI.getAllPosts();
            window.allPosts = allPosts;
            window.filteredPosts = [...allPosts];
            
            // Check for search parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const searchParam = urlParams.get('search');
            
            if (searchParam) {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.value = searchParam;
                    window.currentSearchTerm = searchParam;
                    applyFiltersAndSearch();
                }
            } else {
                renderPosts();
            }
            
            renderRecentPosts();
            renderPagination();
        } catch (error) {
            console.error('Error initializing blog page:', error);
            showMessage('Failed to load blog posts. Please try again later.', 'error');
        }
    }

    // Initialize post page
    async function initializePostPage() {
        const postSlug = getCurrentPostSlug();
        
        if (!postSlug) {
            showError('No post specified');
            return;
        }
        
        try {
            const post = await SoleraBlogAPI.getPostBySlug(postSlug);
            
            if (!post || post.status !== 'published') {
                showError('Story not found');
                return;
            }
            
            renderPost(post);
            await loadRelatedPosts(post);
            
            // Update page title
            document.title = `${post.title} - Solera Cask`;
        } catch (error) {
            console.error('Error loading post:', error);
            showError('Failed to load story');
        }
    }

    // Get current post slug from URL
    function getCurrentPostSlug() {
        const path = window.location.pathname;
        const segments = path.split('/');
        
        // Handle different URL structures
        if (segments.includes('post') && segments.length > segments.indexOf('post') + 1) {
            return segments[segments.indexOf('post') + 1];
        }
        
        // Fallback: check for slug parameter
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('slug') || urlParams.get('post');
    }

    // Render individual post
    function renderPost(post) {
        const loadingMessage = document.getElementById('loadingMessage');
        const postContent = document.getElementById('postContent');
        
        if (loadingMessage) loadingMessage.style.display = 'none';
        if (postContent) postContent.style.display = 'block';
        
        // Update meta information
        const postMeta = document.getElementById('postMeta');
        if (postMeta) {
            postMeta.innerHTML = `
                <span class="post-type">${post.type}</span>
                <span class="post-date">${formatDate(post.date)}</span>
            `;
        }
        
        // Update title
        const postTitle = document.getElementById('postTitle');
        if (postTitle) {
            postTitle.textContent = post.title;
        }
        
        // Update content
        const postText = document.getElementById('postText');
        if (postText) {
            postText.innerHTML = formatPostContent(post.content);
        }
        
        // Handle external link
        const externalLinkContainer = document.getElementById('externalLinkContainer');
        if (externalLinkContainer && post.link && post.link.trim() !== '') {
            externalLinkContainer.innerHTML = `
                <div class="external-link">
                    <a href="${post.link}" target="_blank" rel="noopener noreferrer">
                        Read Original Source →
                    </a>
                </div>
            `;
        }
        
        // Update tags
        const postTags = document.getElementById('postTags');
        if (postTags && post.tags && post.tags.length > 0) {
            postTags.innerHTML = post.tags.map(tag => `
                <a href="/blog?search=${encodeURIComponent(tag)}" class="post-tag">#${tag}</a>
            `).join('');
        }
    }

    // Load related posts
    async function loadRelatedPosts(currentPost) {
        try {
            const allPosts = await SoleraBlogAPI.getAllPosts();
            const otherPosts = allPosts.filter(post => post.id !== currentPost.id);
            
            // Find posts with shared tags or same type
            const relatedPosts = otherPosts
                .map(post => {
                    let score = 0;
                    const sharedTags = post.tags.filter(tag => currentPost.tags.includes(tag));
                    score += sharedTags.length * 2;
                    if (post.type === currentPost.type) score += 1;
                    return { post, score };
                })
                .filter(item => item.score > 0)
                .sort((a, b) => b.score - a.score)
                .slice(0, 3)
                .map(item => item.post);
            
            const relatedContainer = document.getElementById('relatedPosts');
            if (relatedContainer) {
                if (relatedPosts.length === 0) {
                    relatedContainer.innerHTML = '<p style="text-align: center; color: var(--text-light);">No related stories found.</p>';
                } else {
                    relatedContainer.innerHTML = relatedPosts.map(post => `
                        <div class="related-post" onclick="navigateToPost('${post.id}')">
                            <div class="related-post-meta">
                                <span class="post-type">${post.type}</span>
                                <span class="post-date">${formatDate(post.date)}</span>
                            </div>
                            <h4>${post.title}</h4>
                            <p>${post.excerpt || post.content.substring(0, 100)}...</p>
                        </div>
                    `).join('');
                }
            }
        } catch (error) {
            console.error('Error loading related posts:', error);
        }
    }

    // Navigate to post
    function navigateToPost(postId) {
        // For now, we'll use the database to get the post
        SoleraBlogAPI.getPost(postId).then(post => {
            if (post) {
                const postSlug = SoleraBlogAPI.createPostSlug(post);
                window.location.href = `/post/${postSlug}`;
            }
        });
    }

    // Format post content
    function formatPostContent(content) {
        if (!content) return '';
        
        // Split into paragraphs and format
        const paragraphs = content.split('\n\n').filter(p => p.trim());
        
        return paragraphs.map(paragraph => {
            const trimmed = paragraph.trim();
            if (!trimmed) return '';
            
            // Handle images (markdown format)
            if (trimmed.match(/^!\[.*?\]\(.*?\)$/)) {
                const match = trimmed.match(/^!\[(.*?)\]\((.*?)\)$/);
                if (match) {
                    const altText = match[1];
                    const src = match[2];
                    return `<figure><img src="${src}" alt="${altText}" loading="lazy"><figcaption>${altText}</figcaption></figure>`;
                }
            }
            
            // Format markdown-style elements
            let formatted = trimmed
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            // Handle headers
            if (formatted.startsWith('## ')) {
                return `<h2>${formatted.substring(3)}</h2>`;
            } else if (formatted.startsWith('# ')) {
                return `<h3>${formatted.substring(2)}</h3>`;
            }
            
            return `<p>${formatted}</p>`;
        }).join('');
    }

    // Blog listing functions
    function renderPosts() {
        const postsGrid = document.getElementById('postsGrid');
        if (!postsGrid || !window.filteredPosts) return;
        
        const startIndex = ((window.currentPage || 1) - 1) * (window.postsPerPage || 6);
        const endIndex = startIndex + (window.postsPerPage || 6);
        const postsToShow = window.filteredPosts.slice(startIndex, endIndex);
        
        if (postsToShow.length === 0) {
            postsGrid.innerHTML = `
                <div class="no-posts">
                    <h3>No stories found</h3>
                    <p>Try adjusting your search terms or filters.</p>
                </div>
            `;
            return;
        }
        
        postsGrid.innerHTML = postsToShow.map(post => createPostCard(post)).join('');
    }

    function createPostCard(post) {
        return `
            <div class="post-card" onclick="openPostPage('${post.id}')">
                <div class="post-header">
                    <span class="post-type">${post.type}</span>
                    <span class="post-date">${formatDate(post.date)}</span>
                </div>
                <div class="post-content">
                    <h3>${post.title}</h3>
                    <p>${post.excerpt || post.content.substring(0, 150)}${post.content.length > 150 ? '...' : ''}</p>
                    ${post.link && post.link !== '#' ? `<a href="${post.link}" target="_blank" class="post-link" onclick="event.stopPropagation()">Read More →</a>` : ''}
                </div>
                <div class="post-tags">
                    ${post.tags.slice(0, 3).map(tag => `<span class="post-tag" onclick="event.stopPropagation(); searchByTag('${tag}')">#${tag}</span>`).join('')}
                </div>
            </div>
        `;
    }

    function openPostPage(postId) {
        SoleraBlogAPI.getPost(postId).then(post => {
            if (post) {
                const postSlug = SoleraBlogAPI.createPostSlug(post);
                window.location.href = `/post/${postSlug}`;
            } else {
                showMessage('Story not found', 'error');
            }
        });
    }

    async function renderRecentPosts() {
        try {
            const recentPosts = await SoleraBlogAPI.getAllPosts();
            const recentPostsList = document.getElementById('recentPostsList');
            
            if (!recentPostsList) return;
            
            recentPostsList.innerHTML = recentPosts.slice(0, 5).map(post => `
                <div class="recent-post-item" onclick="openPostPage('${post.id}')">
                    <h4>${post.title}</h4>
                    <div class="post-date">${formatDate(post.date)}</div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error rendering recent posts:', error);
        }
    }

    // Search and filter functions
    function applyFiltersAndSearch() {
        if (!window.allPosts) return;
        
        let posts = [...window.allPosts];
        
        // Apply category filter
        if (window.currentFilter && window.currentFilter !== 'all') {
            posts = posts.filter(post => 
                post.type.toLowerCase().replace(/[^a-z]/g, '-') === window.currentFilter ||
                post.type.toLowerCase().replace(/\s+/g, '-') === window.currentFilter
            );
        }
        
        // Apply search filter
        if (window.currentSearchTerm) {
            const searchTerm = window.currentSearchTerm.toLowerCase();
            posts = posts.filter(post => 
                post.title.toLowerCase().includes(searchTerm) ||
                post.content.toLowerCase().includes(searchTerm) ||
                (post.excerpt && post.excerpt.toLowerCase().includes(searchTerm)) ||
                post.tags.some(tag => tag.toLowerCase().includes(searchTerm))
            );
        }
        
        window.filteredPosts = posts;
        window.currentPage = 1;
        renderPosts();
        renderPagination();
        
        // Show search results info
        const searchInfo = document.querySelector('.search-results-info');
        if (searchInfo) searchInfo.remove();
        
        if (window.currentSearchTerm) {
            const infoDiv = document.createElement('div');
            infoDiv.className = 'search-results-info';
            infoDiv.textContent = `Found ${window.filteredPosts.length} stories matching "${window.currentSearchTerm}"`;
            
            const postsGrid = document.getElementById('postsGrid');
            if (postsGrid) {
                postsGrid.parentNode.insertBefore(infoDiv, postsGrid);
            }
        }
    }

    function renderPagination() {
        const pagination = document.getElementById('pagination');
        if (!pagination || !window.filteredPosts) return;
        
        const totalPages = Math.ceil(window.filteredPosts.length / (window.postsPerPage || 6));
        const currentPage = window.currentPage || 1;
        
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }
        
        let paginationHTML = '';
        
        // Previous button
        paginationHTML += `
            <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                ← Previous
            </button>
        `;
        
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                paginationHTML += `
                    <button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>
                        ${i}
                    </button>
                `;
            } else if (i === currentPage - 3 || i === currentPage + 3) {
                paginationHTML += '<span style="color: var(--text-light);">...</span>';
            }
        }
        
        // Next button
        paginationHTML += `
            <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                Next →
            </button>
        `;
        
        pagination.innerHTML = paginationHTML;
    }

    // Utility functions
    function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    }

    function showError(message) {
        const loadingMessage = document.getElementById('loadingMessage');
        const postContent = document.getElementById('postContent');
        const errorContent = document.getElementById('errorContent');
        
        if (loadingMessage) loadingMessage.style.display = 'none';
        if (postContent) postContent.style.display = 'none';
        if (errorContent) errorContent.style.display = 'block';
        
        console.error('Post page error:', message);
    }

    function showMessage(message, type = 'info') {
        const messageEl = document.createElement('div');
        messageEl.className = `message ${type}`;
        messageEl.textContent = message;
        messageEl.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 2rem;
            border-radius: 0;
            z-index: 2000;
            max-width: 400px;
            box-shadow: var(--shadow-strong);
            animation: slideInRight 0.3s ease-out;
            font-weight: 500;
        `;
        
        // Style based on type
        if (type === 'success') {
            messageEl.style.background = 'rgba(6, 255, 165, 0.1)';
            messageEl.style.border = '1px solid rgba(6, 255, 165, 0.3)';
            messageEl.style.color = '#06ffa5';
        } else if (type === 'error') {
            messageEl.style.background = 'rgba(255, 68, 68, 0.1)';
            messageEl.style.border = '1px solid rgba(255, 68, 68, 0.3)';
            messageEl.style.color = '#ff4444';
        } else {
            messageEl.style.background = 'var(--cream)';
            messageEl.style.border = '1px solid var(--primary)';
            messageEl.style.color = 'var(--primary)';
        }
        
        document.body.appendChild(messageEl);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            messageEl.style.animation = 'slideOutRight 0.3s ease-out';
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.parentNode.removeChild(messageEl);
                }
            }, 300);
        }, 5000);
    }

    // Global functions for blog navigation
    window.openPostPage = openPostPage;
    window.navigateToPost = navigateToPost;
    window.filterPosts = function(type) {
        window.currentFilter = type;
        window.currentPage = 1;
        applyFiltersAndSearch();
    };
    window.setActiveFilter = function(button) {
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
    };
    window.changePage = function(page) {
        const totalPages = Math.ceil((window.filteredPosts || []).length / (window.postsPerPage || 6));
        if (page < 1 || page > totalPages) return;
        
        window.currentPage = page;
        renderPosts();
        renderPagination();
        
        // Scroll to top of posts
        const blogMain = document.querySelector('.blog-main');
        if (blogMain) {
            blogMain.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
    };
    window.searchPosts = function() {
        const searchInput = document.getElementById('searchInput');
        if (!searchInput) return;
        
        const searchTerm = searchInput.value.toLowerCase().trim();
        window.currentSearchTerm = searchTerm;
        window.currentPage = 1;
        
        applyFiltersAndSearch();
    };
    window.searchByTag = function(tag) {
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.value = tag;
            window.currentSearchTerm = tag;
            applyFiltersAndSearch();
        }
    };

    // Initialize search functionality
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        // Search on Enter key
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                window.searchPosts();
            }
        });
        
        // Search on input with debounce
        let searchTimeout;
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                window.searchPosts();
            }, 300);
        });
    }

    // Solera Cask Accessibility Toolbar
// Elegant accessibility features matching Solera's sophisticated design

class SoleraAccessibilityToolbar {
    constructor() {
        this.settings = {
            textSize: 'normal',
            grayscale: false,
            highContrast: false,
            negativeContrast: false,
            lightBackground: false,
            linksUnderline: false,
            readableFont: false
        };

        this.isOpen = false;
        this.isInitialized = false;
        this.eventListenersAttached = false;

        this.init();
    }

    init() {
        if (this.isInitialized) return;

        this.loadSettings();
        this.addStyles();
        this.createToggleButton();
        this.createToolbar();
        this.setupPersistentEventListeners();
        this.applySettings();
        this.updateUI();
        this.ensureToolbarVisibility();

        this.isInitialized = true;
        console.log('Solera Accessibility Toolbar initialized');
    }

    loadSettings() {
        Object.keys(this.settings).forEach(key => {
            const stored = localStorage.getItem(`solera-a11y-${key}`);
            if (stored !== null) {
                this.settings[key] = stored === 'true' ? true : stored === 'false' ? false : stored;
            }
        });
    }

    createToggleButton() {
        let button = document.getElementById('soleraAccessibilityToggle');
        if (!button) {
            button = document.createElement('button');
            button.id = 'soleraAccessibilityToggle';
            button.className = 'solera-accessibility-toggle-btn';
            button.setAttribute('data-solera-a11y-toggle', 'true');
            button.setAttribute('aria-label', 'Open accessibility options');
            button.innerHTML = `
                <span class="solera-accessibility-icon" aria-hidden="true">♿︎</span>
            `;
            document.body.appendChild(button);
            console.log('Solera accessibility toggle button created');
        }
    }

    createToolbar() {
        let toolbar = document.getElementById('solera-accessibility-toolbar');
        if (!toolbar) {
            toolbar = document.createElement('div');
            toolbar.id = 'solera-accessibility-toolbar';
            toolbar.className = 'solera-accessibility-toolbar';
            toolbar.setAttribute('data-solera-a11y-toolbar', 'true');
            toolbar.innerHTML = `
                <div class="solera-a11y-header">
                    <div class="solera-a11y-title">
                        <span class="solera-a11y-icon">♿︎</span>
                        <span>Accessibility Options</span>
                    </div>
                    <button class="solera-a11y-close" data-solera-a11y-close="true" aria-label="Close accessibility options">
                        <span>✕</span>
                    </button>
                </div>
                <div class="solera-a11y-content" data-solera-a11y-content="true">
                    <div class="solera-a11y-section">
                        <h3>Text Size</h3>
                        <div class="solera-a11y-button-group">
                            <button class="solera-a11y-option" data-solera-a11y-action="decreaseText">
                                <span class="solera-a11y-option-icon">A−</span>
                                <span class="solera-a11y-option-text">Smaller</span>
                            </button>
                            <div class="solera-text-size-indicator" id="soleraTextSizeDisplay">${this.getTextSizeLabel()}</div>
                            <button class="solera-a11y-option" data-solera-a11y-action="increaseText">
                                <span class="solera-a11y-option-icon">A+</span>
                                <span class="solera-a11y-option-text">Larger</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="solera-a11y-section">
                        <h3>Visual Adjustments</h3>
                        <button class="solera-a11y-option solera-a11y-toggle" data-solera-a11y-action="highContrast">
                            <span class="solera-a11y-option-icon">◐</span>
                            <span class="solera-a11y-option-text">High Contrast</span>
                        </button>
                        <button class="solera-a11y-option solera-a11y-toggle" data-solera-a11y-action="grayscale">
                            <span class="solera-a11y-option-icon">⚫</span>
                            <span class="solera-a11y-option-text">Grayscale</span>
                        </button>
                        <button class="solera-a11y-option solera-a11y-toggle" data-solera-a11y-action="negativeContrast">
                            <span class="solera-a11y-option-icon">◑</span>
                            <span class="solera-a11y-option-text">Negative Contrast</span>
                        </button>
                        <button class="solera-a11y-option solera-a11y-toggle" data-solera-a11y-action="lightBackground">
                            <span class="solera-a11y-option-icon">☀</span>
                            <span class="solera-a11y-option-text">Light Background</span>
                        </button>
                    </div>
                    
                    <div class="solera-a11y-section">
                        <h3>Reading & Navigation</h3>
                        <button class="solera-a11y-option solera-a11y-toggle" data-solera-a11y-action="linksUnderline">
                            <span class="solera-a11y-option-icon">_</span>
                            <span class="solera-a11y-option-text">Underline Links</span>
                        </button>
                        <button class="solera-a11y-option solera-a11y-toggle" data-solera-a11y-action="readableFont">
                            <span class="solera-a11y-option-icon">Aa</span>
                            <span class="solera-a11y-option-text">Readable Font</span>
                        </button>
                    </div>
                    
                    <div class="solera-a11y-section">
                        <button class="solera-a11y-reset" data-solera-a11y-action="reset">
                            <span class="solera-a11y-option-icon">↺</span>
                            <span class="solera-a11y-option-text">Reset All Settings</span>
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(toolbar);
            console.log('Solera accessibility toolbar created');
        }
    }

    addStyles() {
        let styles = document.getElementById('solera-accessibility-toolbar-styles');
        if (!styles) {
            styles = document.createElement('style');
            styles.id = 'solera-accessibility-toolbar-styles';
            document.head.appendChild(styles);
        }

        styles.textContent = `
            /* Solera Accessibility Toggle Button */
            .solera-accessibility-toggle-btn {
                position: fixed !important;
                top: 50% !important;
                right: 20px !important;
                transform: translateY(-50%) !important;
                background: var(--primary) !important;
                border: 1px solid var(--border) !important;
                color: var(--text-white) !important;
                font-family: 'Inter', sans-serif !important;
                font-size: 20px !important;
                padding: 12px !important;
                cursor: pointer !important;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
                border-radius: 50% !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                width: 48px !important;
                height: 48px !important;
                box-shadow: var(--shadow-medium) !important;
                z-index: 9998 !important;
                filter: none !important;
                -webkit-filter: none !important;
                isolation: isolate !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            .solera-accessibility-toggle-btn:hover {
                background: var(--accent-gold) !important;
                color: var(--text-primary) !important;
                transform: translateY(-50%) scale(1.05) !important;
                box-shadow: var(--shadow-strong) !important;
            }

            .solera-accessibility-icon {
                color: inherit !important;
                font-size: 20px !important;
                filter: none !important;
                -webkit-filter: none !important;
                line-height: 1 !important;
            }

            /* Solera Accessibility Toolbar */
            .solera-accessibility-toolbar {
                position: fixed !important;
                top: 50% !important;
                right: -420px !important;
                transform: translateY(-50%) !important;
                width: 380px !important;
                max-height: 80vh !important;
                background: var(--warm-white) !important;
                border: 1px solid var(--border) !important;
                border-radius: 0 !important;
                box-shadow: var(--shadow-strong) !important;
                z-index: 9999 !important;
                transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
                font-family: 'Inter', sans-serif !important;
                filter: none !important;
                -webkit-filter: none !important;
                isolation: isolate !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
                overflow: hidden !important;
            }

            .solera-accessibility-toolbar.open {
                right: 20px !important;
            }

            /* Elegant Header */
            .solera-a11y-header {
                display: flex !important;
                align-items: center !important;
                justify-content: space-between !important;
                padding: 24px !important;
                background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%) !important;
                color: var(--text-white) !important;
                position: relative !important;
            }

            .solera-a11y-title {
                display: flex !important;
                align-items: center !important;
                gap: 12px !important;
                font-family: 'Playfair Display', serif !important;
                font-weight: 400 !important;
                font-size: 18px !important;
                color: var(--text-white) !important;
            }

            .solera-a11y-icon {
                font-size: 24px !important;
                color: var(--accent-gold) !important;
                filter: none !important;
                -webkit-filter: none !important;
            }

            .solera-a11y-close {
                background: transparent !important;
                border: 1px solid rgba(255, 255, 255, 0.3) !important;
                color: var(--text-white) !important;
                cursor: pointer !important;
                padding: 8px !important;
                border-radius: 4px !important;
                font-size: 14px !important;
                font-family: 'Inter', sans-serif !important;
                transition: all 0.3s ease !important;
                width: 32px !important;
                height: 32px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                filter: none !important;
                -webkit-filter: none !important;
            }

            .solera-a11y-close:hover {
                background: rgba(255, 255, 255, 0.1) !important;
                border-color: rgba(255, 255, 255, 0.5) !important;
                transform: scale(1.05) !important;
            }

            /* Content Area */
            .solera-a11y-content {
                padding: 24px !important;
                background: var(--warm-white) !important;
                color: var(--text-primary) !important;
                max-height: calc(80vh - 96px) !important;
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch !important;
            }

            /* Custom scrollbar for webkit browsers */
            .solera-a11y-content::-webkit-scrollbar {
                width: 6px !important;
            }

            .solera-a11y-content::-webkit-scrollbar-track {
                background: var(--light-beige) !important;
            }

            .solera-a11y-content::-webkit-scrollbar-thumb {
                background: var(--accent-gold) !important;
                border-radius: 3px !important;
            }

            .solera-a11y-content::-webkit-scrollbar-thumb:hover {
                background: var(--primary-dark) !important;
            }

            /* Sections */
            .solera-a11y-section {
                margin-bottom: 32px !important;
            }

            .solera-a11y-section:last-child {
                margin-bottom: 0 !important;
            }

            .solera-a11y-section h3 {
                font-family: 'Playfair Display', serif !important;
                font-weight: 400 !important;
                font-size: 16px !important;
                color: var(--text-primary) !important;
                margin-bottom: 16px !important;
                padding-bottom: 8px !important;
                border-bottom: 1px solid var(--border-light) !important;
            }

            /* Button Groups */
            .solera-a11y-button-group {
                display: flex !important;
                align-items: center !important;
                gap: 12px !important;
                margin-bottom: 16px !important;
            }

            /* Option Buttons */
            .solera-a11y-option {
                display: flex !important;
                align-items: center !important;
                gap: 12px !important;
                padding: 12px 16px !important;
                background: var(--cream) !important;
                border: 1px solid var(--border) !important;
                text-align: left !important;
                cursor: pointer !important;
                border-radius: 4px !important;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
                color: var(--text-primary) !important;
                font-family: 'Inter', sans-serif !important;
                font-size: 14px !important;
                font-weight: 500 !important;
                width: 100% !important;
                margin-bottom: 8px !important;
                position: relative !important;
                overflow: hidden !important;
                filter: none !important;
                -webkit-filter: none !important;
            }

            .solera-a11y-button-group .solera-a11y-option {
                flex: 1 !important;
                width: auto !important;
                margin-bottom: 0 !important;
                justify-content: center !important;
                text-align: center !important;
            }

            .solera-a11y-option::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: -100% !important;
                width: 100% !important;
                height: 100% !important;
                background: var(--accent-gold) !important;
                transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
                z-index: -1 !important;
            }

            .solera-a11y-option:hover::before {
                left: 0 !important;
            }

            .solera-a11y-option:hover {
                border-color: var(--accent-gold) !important;
                transform: translateY(-1px) !important;
                box-shadow: var(--shadow-subtle) !important;
                color: var(--text-primary) !important;
            }

            .solera-a11y-option.active {
                background: var(--primary) !important;
                border-color: var(--primary) !important;
                color: var(--text-white) !important;
            }

            .solera-a11y-option.active::before {
                background: var(--primary-dark) !important;
                left: 0 !important;
            }

            .solera-a11y-option.active:hover {
                background: var(--primary-dark) !important;
                border-color: var(--primary-dark) !important;
                color: var(--text-white) !important;
            }

            .solera-a11y-option-icon {
                font-size: 16px !important;
                min-width: 20px !important;
                filter: none !important;
                -webkit-filter: none !important;
                font-weight: 600 !important;
            }

            .solera-a11y-option-text {
                flex: 1 !important;
                color: inherit !important;
            }

            /* Text Size Indicator */
            .solera-text-size-indicator {
                font-family: 'Playfair Display', serif !important;
                font-size: 14px !important;
                font-weight: 600 !important;
                background: var(--primary) !important;
                color: var(--text-white) !important;
                padding: 8px 12px !important;
                border: 1px solid var(--primary) !important;
                border-radius: 4px !important;
                min-width: 40px !important;
                text-align: center !important;
                flex-shrink: 0 !important;
            }

            /* Reset Button */
            .solera-a11y-reset {
                background: var(--light-beige) !important;
                border: 1px solid var(--rich-brown) !important;
                color: var(--rich-brown) !important;
                font-weight: 600 !important;
            }

            .solera-a11y-reset::before {
                background: var(--rich-brown) !important;
            }

            .solera-a11y-reset:hover {
                border-color: var(--rich-brown) !important;
                color: var(--text-white) !important;
            }

            .solera-a11y-reset.active {
                background: var(--rich-brown) !important;
                border-color: var(--rich-brown) !important;
                color: var(--text-white) !important;
            }

            /* Accessibility Features - Text Size (Adjusted scaling + H1 fix) */
            html.solera-a11y-increased-text,
            html.solera-a11y-increased-text body,
            html.solera-a11y-increased-text * { 
                font-size: 103% !important; 
                line-height: 1.6 !important;
            }
            
            html.solera-a11y-extra-large-text,
            html.solera-a11y-extra-large-text body,
            html.solera-a11y-extra-large-text * { 
                font-size: 105% !important; 
                line-height: 1.6 !important;
            }
            
            html.solera-a11y-decreased-text,
            html.solera-a11y-decreased-text body,
            html.solera-a11y-decreased-text * { 
                font-size: 95% !important; 
                line-height: 1.6 !important;
            }
            
            html.solera-a11y-extra-small-text,
            html.solera-a11y-extra-small-text body,
            html.solera-a11y-extra-small-text * { 
                font-size: 88% !important; 
                line-height: 1.6 !important;
            }

            /* Fix H1, H2, H3, etc. to scale properly with increased text - VERY SPECIFIC SELECTORS */
            html.solera-a11y-increased-text h1,
            html.solera-a11y-increased-text .hero h1,
            html.solera-a11y-increased-text .heritage-content h2,
            html.solera-a11y-increased-text .story-content h2,
            html.solera-a11y-increased-text .contact-info h2,
            html.solera-a11y-increased-text .section-title,
            html.solera-a11y-increased-text .hero-title,
            html.solera-a11y-increased-text .page-title,
            html.solera-a11y-increased-text h2,
            html.solera-a11y-increased-text h3,
            html.solera-a11y-increased-text h4,
            html.solera-a11y-increased-text h5,
            html.solera-a11y-increased-text h6,
            html.solera-a11y-increased-text .sherry-intro h2,
            html.solera-a11y-increased-text .blog-hero h1,
            html.solera-a11y-increased-text [class*="title"],
            html.solera-a11y-increased-text [class*="heading"] {
                font-size: calc(1em * 1.03) !important;
                transform: scale(1.03) !important;
                transform-origin: center !important;
            }

            html.solera-a11y-extra-large-text h1,
            html.solera-a11y-extra-large-text .hero h1,
            html.solera-a11y-extra-large-text .heritage-content h2,
            html.solera-a11y-extra-large-text .story-content h2,
            html.solera-a11y-extra-large-text .contact-info h2,
            html.solera-a11y-extra-large-text .section-title,
            html.solera-a11y-extra-large-text .hero-title,
            html.solera-a11y-extra-large-text .page-title,
            html.solera-a11y-extra-large-text h2,
            html.solera-a11y-extra-large-text h3,
            html.solera-a11y-extra-large-text h4,
            html.solera-a11y-extra-large-text h5,
            html.solera-a11y-extra-large-text h6,
            html.solera-a11y-extra-large-text .sherry-intro h2,
            html.solera-a11y-extra-large-text .blog-hero h1,
            html.solera-a11y-extra-large-text [class*="title"],
            html.solera-a11y-extra-large-text [class*="heading"] {
                font-size: calc(1em * 1.05) !important;
                transform: scale(1.05) !important;
                transform-origin: center !important;
            }

            /* Override specific clamp() functions that are resisting scaling */
            html.solera-a11y-increased-text .hero h1 {
                font-size: clamp(36px * 1.03, 6vw * 1.03, 64px * 1.03) !important;
            }

            html.solera-a11y-extra-large-text .hero h1 {
                font-size: clamp(36px * 1.05, 6vw * 1.05, 64px * 1.05) !important;
            }

            html.solera-a11y-increased-text .heritage-content h2,
            html.solera-a11y-increased-text .story-content h2,
            html.solera-a11y-increased-text .contact-info h2 {
                font-size: clamp(36px * 1.03, 5vw * 1.03, 56px * 1.03) !important;
            }

            html.solera-a11y-extra-large-text .heritage-content h2,
            html.solera-a11y-extra-large-text .story-content h2,
            html.solera-a11y-extra-large-text .contact-info h2 {
                font-size: clamp(36px * 1.05, 5vw * 1.05, 56px * 1.05) !important;
            }

            html.solera-a11y-increased-text .sherry-intro h2 {
                font-size: clamp(36px * 1.03, 5vw * 1.03, 56px * 1.03) !important;
            }

            html.solera-a11y-extra-large-text .sherry-intro h2 {
                font-size: clamp(36px * 1.05, 5vw * 1.05, 56px * 1.05) !important;
            }

            /* Smart Navigation Adjustments for Larger Text Sizes */
            html.solera-a11y-increased-text nav {
                padding: 12px 0 !important;
            }

            html.solera-a11y-extra-large-text nav {
                padding: 8px 0 !important;
            }

            html.solera-a11y-increased-text .nav-links {
                gap: 20px !important;
            }

            html.solera-a11y-extra-large-text .nav-links {
                gap: 16px !important;
            }

            html.solera-a11y-increased-text .nav-links a {
                font-size: 14px !important;
                padding: 8px 14px !important;
                white-space: nowrap !important;
            }

            html.solera-a11y-extra-large-text .nav-links a {
                font-size: 13px !important;
                padding: 6px 12px !important;
                white-space: nowrap !important;
            }

            /* Keep logo at reasonable size */
            html.solera-a11y-increased-text .logo,
            html.solera-a11y-extra-large-text .logo {
                font-size: 24px !important;
            }

            /* Adjust GET QUOTE button */
            html.solera-a11y-increased-text .btn-primary {
                font-size: 12px !important;
                padding: 14px 24px !important;
            }

            html.solera-a11y-extra-large-text .btn-primary {
                font-size: 11px !important;
                padding: 12px 20px !important;
            }

            /* Mobile menu adjustments for larger text */
            @media (max-width: 1200px) {
                html.solera-a11y-extra-large-text .nav-links {
                    display: none !important;
                }
                
                html.solera-a11y-extra-large-text .mobile-menu-toggle {
                    display: block !important;
                }
            }

            @media (max-width: 1400px) {
                html.solera-a11y-increased-text .nav-links {
                    display: none !important;
                }
                
                html.solera-a11y-increased-text .mobile-menu-toggle {
                    display: block !important;
                }
            }

            /* Ensure container doesn't overflow */
            html.solera-a11y-increased-text .container,
            html.solera-a11y-extra-large-text .container {
                padding: 0 30px !important;
            }

            /* Header height adjustments */
            html.solera-a11y-increased-text header,
            html.solera-a11y-extra-large-text header {
                min-height: auto !important;
            }

            /* Reset font-size for toolbar elements to prevent scaling */
            html.solera-a11y-increased-text .solera-accessibility-toolbar,
            html.solera-a11y-increased-text .solera-accessibility-toolbar *,
            html.solera-a11y-increased-text .solera-accessibility-toggle-btn,
            html.solera-a11y-increased-text .solera-accessibility-toggle-btn *,
            html.solera-a11y-extra-large-text .solera-accessibility-toolbar,
            html.solera-a11y-extra-large-text .solera-accessibility-toolbar *,
            html.solera-a11y-extra-large-text .solera-accessibility-toggle-btn,
            html.solera-a11y-extra-large-text .solera-accessibility-toggle-btn *,
            html.solera-a11y-decreased-text .solera-accessibility-toolbar,
            html.solera-a11y-decreased-text .solera-accessibility-toolbar *,
            html.solera-a11y-decreased-text .solera-accessibility-toggle-btn,
            html.solera-a11y-decreased-text .solera-accessibility-toggle-btn *,
            html.solera-a11y-extra-small-text .solera-accessibility-toolbar,
            html.solera-a11y-extra-small-text .solera-accessibility-toolbar *,
            html.solera-a11y-extra-small-text .solera-accessibility-toggle-btn,
            html.solera-a11y-extra-small-text .solera-accessibility-toggle-btn * {
                font-size: revert !important;
            }

            /* Specific toolbar font sizes to ensure they stay consistent */
            .solera-accessibility-toggle-btn {
                font-size: 20px !important;
            }
            
            .solera-a11y-title {
                font-size: 18px !important;
            }
            
            .solera-a11y-close {
                font-size: 14px !important;
            }
            
            .solera-a11y-section h3 {
                font-size: 16px !important;
            }
            
            .solera-a11y-option {
                font-size: 14px !important;
            }
            
            .solera-text-size-indicator {
                font-size: 14px !important;
            }
            html.solera-a11y-grayscale { filter: grayscale(100%) !important; }
            html.solera-a11y-high-contrast { filter: contrast(150%) brightness(1.2) !important; }
            html.solera-a11y-negative-contrast { filter: invert(1) hue-rotate(180deg) !important; }
            html.solera-a11y-light-background {
                background: #ffffff !important;
                color: #000000 !important;
            }
            html.solera-a11y-light-background * {
                background: inherit !important;
                color: inherit !important;
            }
            html.solera-a11y-links-underline a { text-decoration: underline !important; }
            html.solera-a11y-readable-font * { 
                font-family: 'Times New Roman', 'Times', serif !important; 
            }

            /* Exclude toolbar from accessibility effects */
            .solera-accessibility-toolbar, .solera-accessibility-toolbar *,
            .solera-accessibility-toggle-btn, .solera-accessibility-toggle-btn * {
                filter: none !important;
                -webkit-filter: none !important;
                isolation: isolate !important;
                visibility: visible !important;
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* Mobile Responsive Design */
            @media (max-width: 768px) {
                .solera-accessibility-toggle-btn {
                    right: 15px !important;
                    width: 44px !important;
                    height: 44px !important;
                    font-size: 18px !important;
                }

                .solera-accessibility-toolbar {
                    width: calc(100vw - 30px) !important;
                    right: -100vw !important;
                    top: 20px !important;
                    transform: none !important;
                    max-height: calc(100vh - 40px) !important;
                }
                
                .solera-accessibility-toolbar.open {
                    right: 15px !important;
                }
                
                .solera-a11y-header {
                    padding: 20px !important;
                }
                
                .solera-a11y-title {
                    font-size: 16px !important;
                    gap: 10px !important;
                }
                
                .solera-a11y-icon {
                    font-size: 20px !important;
                }
                
                .solera-a11y-content {
                    padding: 20px !important;
                    max-height: calc(100vh - 136px) !important;
                }
                
                .solera-a11y-section {
                    margin-bottom: 24px !important;
                }
                
                .solera-a11y-option {
                    padding: 14px 16px !important;
                    font-size: 15px !important;
                }
                
                .solera-a11y-button-group {
                    flex-direction: column !important;
                    gap: 8px !important;
                }
                
                .solera-a11y-button-group .solera-a11y-option {
                    width: 100% !important;
                    justify-content: flex-start !important;
                    text-align: left !important;
                }
                
                .solera-text-size-indicator {
                    align-self: center !important;
                    margin: 8px 0 !important;
                }
            }

            /* Extra small mobile screens */
            @media (max-width: 480px) {
                .solera-accessibility-toolbar {
                    width: calc(100vw - 20px) !important;
                }
                
                .solera-accessibility-toolbar.open {
                    right: 10px !important;
                }
                
                .solera-a11y-header {
                    padding: 16px !important;
                }
                
                .solera-a11y-title {
                    font-size: 15px !important;
                }
                
                .solera-a11y-content {
                    padding: 16px !important;
                }
                
                .solera-a11y-option {
                    padding: 12px 14px !important;
                    font-size: 14px !important;
                }
            }
        `;
    }

    setupPersistentEventListeners() {
        if (this.eventListenersAttached) return;

        const globalClickHandler = (e) => {
            if (!e.target) return;

            const toggleButton = e.target.closest('[data-solera-a11y-toggle]');
            if (toggleButton) {
                e.preventDefault();
                e.stopPropagation();
                this.toggle();
                return;
            }

            const closeButton = e.target.closest('[data-solera-a11y-close]');
            if (closeButton) {
                e.preventDefault();
                e.stopPropagation();
                this.close();
                return;
            }

            const actionButton = e.target.closest('[data-solera-a11y-action]');
            if (actionButton) {
                e.preventDefault();
                const action = actionButton.getAttribute('data-solera-a11y-action');
                this.handleAction(action);
                return;
            }

            const toolbar = document.querySelector('[data-solera-a11y-toolbar]');
            const mainToggleButton = document.querySelector('[data-solera-a11y-toggle]');
            if (this.isOpen && toolbar && mainToggleButton && 
                !toolbar.contains(e.target) && !mainToggleButton.contains(e.target)) {
                this.close();
            }
        };

        const globalKeyHandler = (e) => {
            if (e.key === 'Escape' && this.isOpen) {
                this.close();
            }
        };

        document.addEventListener('click', globalClickHandler, true);
        document.addEventListener('keydown', globalKeyHandler, true);

        const observer = new MutationObserver(() => {
            if (!document.querySelector('#soleraAccessibilityToggle')) {
                this.createToggleButton();
            }
            if (!document.querySelector('#solera-accessibility-toolbar')) {
                this.createToolbar();
            }
            this.ensureToolbarVisibility();
        });
        observer.observe(document.body, { childList: true, subtree: true });

        window.addEventListener('resize', () => this.handleResize());

        this.globalClickHandler = globalClickHandler;
        this.globalKeyHandler = globalKeyHandler;
        this.mutationObserver = observer;
        this.eventListenersAttached = true;
    }

    toggle() {
        if (this.isOpen) {
            this.close();
        } else {
            this.open();
        }
    }

    open() {
        const toolbar = document.getElementById('solera-accessibility-toolbar');
        if (!toolbar) {
            this.createToolbar();
            return this.open();
        }

        this.isOpen = true;
        toolbar.classList.add('open');
        this.ensureToolbarVisibility();
    }

    close() {
        const toolbar = document.getElementById('solera-accessibility-toolbar');
        if (!toolbar) return;

        this.isOpen = false;
        toolbar.classList.remove('open');
    }

    handleAction(action) {
        switch (action) {
            case 'increaseText':
                if (this.settings.textSize === 'normal') this.settings.textSize = 'large';
                else if (this.settings.textSize === 'large') this.settings.textSize = 'extra-large';
                else if (this.settings.textSize === 'small') this.settings.textSize = 'normal';
                else if (this.settings.textSize === 'extra-small') this.settings.textSize = 'small';
                break;
            case 'decreaseText':
                if (this.settings.textSize === 'normal') this.settings.textSize = 'small';
                else if (this.settings.textSize === 'small') this.settings.textSize = 'extra-small';
                else if (this.settings.textSize === 'large') this.settings.textSize = 'normal';
                else if (this.settings.textSize === 'extra-large') this.settings.textSize = 'large';
                break;
            case 'grayscale':
                this.settings.grayscale = !this.settings.grayscale;
                break;
            case 'highContrast':
                this.settings.highContrast = !this.settings.highContrast;
                break;
            case 'negativeContrast':
                this.settings.negativeContrast = !this.settings.negativeContrast;
                break;
            case 'lightBackground':
                this.settings.lightBackground = !this.settings.lightBackground;
                break;
            case 'linksUnderline':
                this.settings.linksUnderline = !this.settings.linksUnderline;
                break;
            case 'readableFont':
                this.settings.readableFont = !this.settings.readableFont;
                break;
            case 'reset':
                this.resetAll();
                break;
        }

        this.saveSettings();
        this.applySettings();
        this.updateUI();
        this.ensureToolbarVisibility();
    }

    applySettings() {
        this.applyTextSize();
        this.applyGrayscale();
        this.applyHighContrast();
        this.applyNegativeContrast();
        this.applyLightBackground();
        this.applyLinksUnderline();
        this.applyReadableFont();
        this.ensureToolbarVisibility();
    }

    applyTextSize() {
        const html = document.documentElement;
        
        // Remove all text size classes first
        html.classList.remove(
            'solera-a11y-increased-text',
            'solera-a11y-decreased-text',
            'solera-a11y-extra-large-text',
            'solera-a11y-extra-small-text'
        );

        // Apply the appropriate class based on current setting
        if (this.settings.textSize === 'large') {
            html.classList.add('solera-a11y-increased-text');
            console.log('Applied large text size');
        } else if (this.settings.textSize === 'extra-large') {
            html.classList.add('solera-a11y-extra-large-text');
            console.log('Applied extra-large text size');
        } else if (this.settings.textSize === 'small') {
            html.classList.add('solera-a11y-decreased-text');
            console.log('Applied small text size');
        } else if (this.settings.textSize === 'extra-small') {
            html.classList.add('solera-a11y-extra-small-text');
            console.log('Applied extra-small text size');
        } else {
            console.log('Applied normal text size (no class)');
        }

        // Update the indicator
        const indicator = document.getElementById('soleraTextSizeDisplay');
        if (indicator) {
            indicator.textContent = this.getTextSizeLabel();
        }

        // Force a style recalculation
        document.body.offsetHeight;
    }

    applyGrayscale() {
        document.documentElement.classList.toggle('solera-a11y-grayscale', this.settings.grayscale);
        this.ensureToolbarVisibility();
    }

    applyHighContrast() {
        document.documentElement.classList.toggle('solera-a11y-high-contrast', this.settings.highContrast);
        this.ensureToolbarVisibility();
    }

    applyNegativeContrast() {
        document.documentElement.classList.toggle('solera-a11y-negative-contrast', this.settings.negativeContrast);
        this.ensureToolbarVisibility();
    }

    applyLightBackground() {
        document.documentElement.classList.toggle('solera-a11y-light-background', this.settings.lightBackground);
        this.ensureToolbarVisibility();
    }

    applyLinksUnderline() {
        document.documentElement.classList.toggle('solera-a11y-links-underline', this.settings.linksUnderline);
    }

    applyReadableFont() {
        document.documentElement.classList.toggle('solera-a11y-readable-font', this.settings.readableFont);
    }

    ensureToolbarVisibility() {
        setTimeout(() => {
            const toolbar = document.getElementById('solera-accessibility-toolbar');
            const toggleBtn = document.getElementById('soleraAccessibilityToggle');

            if (toolbar) {
                toolbar.style.cssText += ' filter: none !important; -webkit-filter: none !important; isolation: isolate !important; visibility: visible !important; opacity: 1 !important; pointer-events: auto !important;';
            }

            if (toggleBtn) {
                toggleBtn.style.cssText += ' filter: none !important; -webkit-filter: none !important; isolation: isolate !important; visibility: visible !important; opacity: 1 !important; pointer-events: auto !important;';
            }
        }, 50);
    }

    getTextSizeLabel() {
        switch (this.settings.textSize) {
            case 'extra-small': return 'XS';
            case 'small': return 'S';
            case 'normal': return 'M';
            case 'large': return 'L';
            case 'extra-large': return 'XL';
            default: return 'M';
        }
    }

    updateUI() {
        const options = document.querySelectorAll('.solera-a11y-option');
        options.forEach(option => {
            const action = option.getAttribute('data-solera-a11y-action');
            let isActive = false;

            switch (action) {
                case 'increaseText':
                    isActive = this.settings.textSize === 'large' || this.settings.textSize === 'extra-large';
                    break;
                case 'decreaseText':
                    isActive = this.settings.textSize === 'small' || this.settings.textSize === 'extra-small';
                    break;
                case 'grayscale':
                    isActive = this.settings.grayscale;
                    break;
                case 'highContrast':
                    isActive = this.settings.highContrast;
                    break;
                case 'negativeContrast':
                    isActive = this.settings.negativeContrast;
                    break;
                case 'lightBackground':
                    isActive = this.settings.lightBackground;
                    break;
                case 'linksUnderline':
                    isActive = this.settings.linksUnderline;
                    break;
                case 'readableFont':
                    isActive = this.settings.readableFont;
                    break;
            }

            option.classList.toggle('active', isActive);
        });

        const textSizeDisplay = document.getElementById('soleraTextSizeDisplay');
        if (textSizeDisplay) {
            textSizeDisplay.textContent = this.getTextSizeLabel();
        }
    }

    saveSettings() {
        Object.keys(this.settings).forEach(key => {
            localStorage.setItem(`solera-a11y-${key}`, this.settings[key]);
        });
    }

    resetAll() {
        this.settings = {
            textSize: 'normal',
            grayscale: false,
            highContrast: false,
            negativeContrast: false,
            lightBackground: false,
            linksUnderline: false,
            readableFont: false
        };

        Object.keys(this.settings).forEach(key => {
            localStorage.removeItem(`solera-a11y-${key}`);
        });

        const html = document.documentElement;
        html.classList.remove(
            'solera-a11y-increased-text',
            'solera-a11y-decreased-text',
            'solera-a11y-extra-large-text',
            'solera-a11y-extra-small-text',
            'solera-a11y-grayscale',
            'solera-a11y-high-contrast',
            'solera-a11y-negative-contrast',
            'solera-a11y-light-background',
            'solera-a11y-links-underline',
            'solera-a11y-readable-font'
        );

        this.applySettings();
        this.updateUI();
    }

    handleResize() {
        // Handle any resize-specific logic if needed
        this.ensureToolbarVisibility();
    }

    destroy() {
        if (this.globalClickHandler) {
            document.removeEventListener('click', this.globalClickHandler, true);
        }
        if (this.globalKeyHandler) {
            document.removeEventListener('keydown', this.globalKeyHandler, true);
        }
        if (this.mutationObserver) {
            this.mutationObserver.disconnect();
        }

        const toolbar = document.getElementById('solera-accessibility-toolbar');
        if (toolbar) toolbar.remove();

        const toggleButton = document.getElementById('soleraAccessibilityToggle');
        if (toggleButton) toggleButton.remove();

        const styles = document.getElementById('solera-accessibility-toolbar-styles');
        if (styles) styles.remove();

        this.eventListenersAttached = false;
        this.isInitialized = false;
    }
}

// Initialize the Solera accessibility toolbar
window.soleraAccessibilityToolbar = new SoleraAccessibilityToolbar();

    
    // Initialize global variables
    window.allPosts = [];
    window.filteredPosts = [];
    window.currentPage = 1;
    window.postsPerPage = 6;
    window.currentFilter = 'all';
    window.currentSearchTerm = '';

    // Export the API for use in other scripts
    window.SoleraBlogAPI = SoleraBlogAPI;

    // Listen for storage changes (when admin updates posts)
    window.addEventListener('storage', function(e) {
        if (e.key === 'solera-cask-posts') {
            if (window.location.pathname.includes('/blog')) {
                initializeBlogPage();
            }
        }
    });
});
    </script>
</body>
</html>